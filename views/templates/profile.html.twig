{% extends "layout.html.twig" %}

{% block title %}
    Miaou | Mon profil
{% endblock %}

{% block body %}
    {% block header %}
        {{ parent() }}
    {% endblock %}

    {% block content %}

       {% block error %}
        {% endblock %}
        <section id="profile" class="profile-content">

            {# ===================== TITRE ===================== #}
            <h3>Mon espace personnel</h3>

            {# ===================== MESSAGES ===================== #}
            {% if success_message %}
                <div class="alert alert-success" role="alert">
                    ‚úÖ {{ success_message }}
                </div>
            {% endif %}
            {% if error_message %}
                <div class="alert alert-danger" role="alert">
                    ‚ùå {{ error_message }}
                </div>
            {% endif %}

            {# ===================== INFOS ACTUELLES ===================== #}
            <article class="container-profile">
                <h4>Informations actuelles</h4>

                <div class="form-group">
                    <label>Email :</label>
                    <p>{{ user.email }}</p>
                </div>

                <div class="form-group">
                    <label>Pr√©nom :</label>
                    <p>{{ user.firstname }}</p>
                </div>

                <div class="form-group">
                    <label>√Çge :</label>
                    <p>{{ user.age }} ans</p>
                </div>

                <div class="form-group">
                    <label>Avatar actuel :</label>
                    {% if avatar %}
                       <img class="avatar" src="{{ avatar.urlMini }}" alt="{{ avatar.description }}">
                    {% endif %}
                </div>

                <div class="form-group">
                    <label>Newsletter :</label>
                    <p>
                        {% if user.newsletter == 1 %}
                            <span class="badge badge-success">‚úÖ Abonn√©</span>
                        {% else %}
                            <span class="badge badge-secondary">‚ùå Non abonn√©</span>
                        {% endif %}
                    </p>
                </div>
            </article>

            {# ===================== MODIFICATION PROFIL ===================== #}
            <article class="edit-profile">
                <h4>Modifier mes informations</h4>
                
                <form method="post" id="profile-form" action="?route=updateProfile">
                    
                    <div class="form-group">
                        <label for="firstname">Pr√©nom <span class="required">*</span></label>
                        <input 
                            type="text" 
                            id="firstname" 
                            name="firstname" 
                            value="{{ user.firstname }}" 
                            required
                            minlength="2"
                            maxlength="60">
                        <div class="error-message" id="error-firstname" role="alert"></div>
                    </div>

                    <div class="form-group">
                        <label for="age">√Çge <span class="required">*</span></label>
                        <input 
                            type="number" 
                            id="age" 
                            name="age" 
                            value="{{ user.age }}" 
                            required
                            min="1"
                            max="120">
                        <div class="error-message" id="error-age" role="alert"></div>
                    </div>

                    <div class="form-group">
                        <label for="email">Email <span class="required">*</span></label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            value="{{ user.email }}" 
                            required>
                        <div class="error-message" id="error-email" role="alert"></div>
                    </div>

                   {# ============ S√âLECTION AVATAR ============ #}
                    <div class="form-group" id="avatars-list-container">
                    <label>Choisir un avatar <span class="required">*</span></label>
                    <div class="avatar-grid" id="avatars-list">
                        {% for avatarItem in avatarItems %}
                        <div class="avatar-option">
                            <input 
                            type="radio"
                            id="avatar-{{ avatarItem.id }}"
                            name="avatar"
                            value="{{ avatarItem.id }}"
                            {% if user.avatar == avatarItem.id %}checked{% endif %}
                            required
                            >
                            <label for="avatar-{{ avatarItem.id }}">
                            <img 
                                src="{{ avatarItem.urlMini }}" 
                                alt="{{ avatarItem.description }}"
                                title="{{ avatarItem.name }}"
                            />
                            </label>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="error-message" id="error-avatar" role="alert"></div>
                    </div>

                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    <button type="submit" class="btn btn-primary">
                        üíæ Mettre √† jour mes informations
                    </button>
                </form>
            </article>

            {# ===================== NEWSLETTER ===================== #}
            <article class="newsletter-section">
                <h4>Gestion de la newsletter</h4>
                
                <form method="post" action="?route=toggleNewsletter" class="newsletter-toggle">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    {% if user.newsletter == 1 %}
                        <p>Vous √™tes actuellement <strong>abonn√©</strong> √† notre newsletter.</p>
                        <button type="submit" class="btn btn-warning">
                            üìß Se d√©sabonner de la newsletter
                        </button>
                    {% else %}
                        <p>Vous n'√™tes actuellement <strong>pas abonn√©</strong> √† notre newsletter.</p>
                        <button type="submit" class="btn btn-success">
                            ‚úâÔ∏è S'abonner √† la newsletter
                        </button>
                    {% endif %}
                </form>
            </article>

            {# ===================== CONTACT ===================== #}
            <article class="contact-section">
                <h4>Contacter l'administrateur</h4>
                <p>Besoin d'aide ? Une question ? Envoyez un message !</p>
                <button type="button" id="open-contact" class="btn btn-info">
                    <a href=?route=contactUsForm> üí¨ Ouvrir le formulaire de contact</a>
                </button>
                <div id="contact-form-container"></div>
            </article>

            {# ===================== S√âCURIT√â ===================== #}
            <article class="security-section">
                <h4>S√©curit√©</h4>
                
                <form method="post" action="?route=resetPasswordFromProfile" class="reset-password">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                    
                    <p class="warning-text">
                        ‚ö†Ô∏è La r√©initialisation de votre mot de passe va :
                    </p>
                    <ul>
                        <li>G√©n√©rer un nouveau mot de passe al√©atoire</li>
                        <li>Vous envoyer ce mot de passe par email</li>
                        <li>Vous d√©connecter automatiquement</li>
                    </ul>
                    
                    <button type="submit" class="btn btn-danger">
                        üîí R√©initialiser mon mot de passe
                    </button>
                </form>
            </article>

        </section>
    {% endblock %}
{% endblock %}
