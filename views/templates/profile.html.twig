{% extends "layout.html.twig" %}

{% block title %}
    Miaou | Mon profil
{% endblock %}

{% block body %}
    {% block header %}
        {{ parent() }}
    {% endblock %}

    {% block content %}

       {% block error %}
        {% endblock %}
        <section id="profile" class="profile-content">

            {# ===================== TITRE ===================== #}
            <h3>Mon espace personnel</h3>

            {# ===================== INFOS ACTUELLES ===================== #}
            <article class="container-profile">
                <span class="sr-only">Informations actuelles</span>

                <div class="form-group">
                    <label>Email :</label>
                    <p>{{ user.email }}</p>
                </div>

                <div class="form-group">
                    <label>Prénom :</label>
                    <p>{{ user.firstname }}</p>
                </div>

                <div class="form-group">
                    <label>Avatar actuel :</label>
                    <img src="{{ asset(avatar.urlMini) }}" alt="Avatar actuel" class="avatar-current">
                </div>
            </article>

            {# ===================== MODIFICATION COORDONNÉES ===================== #}
            <form method="post" id="profile-form" action="?route=updateProfile">
                <span class="sr-only">Modifier mes coordonnées</span>

                <label for="firstname">Prénom <span class="required">*</span></label>
                <input type="text" id="firstname" name="firstname" value="{{ user.firstname }}" required>
                <div class="error-message" id="error-firstname"></div>

                <label for="age">Âge <span class="required">*</span></label>
                <input type="number" id="age" name="age" value="{{ user.age }}" required>
                <div class="error-message" id="error-age"></div>

                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" name="email" value="{{ user.email }}" required>
                <div class="error-message" id="error-email"></div>

                {# ============ SECTION AVATARS ============ #}
                <label for="avatars">Choisir un avatar <span aria-label="requis" class="required">*</span></label>
                <article class="avatarItem">
                    <span class="sr-only">Choisir un avatar</span>
                    <ul>
                        {% for avatarItem in avatarItems %}
                        <li>
                            <div class="avatars">
                                <input 
                                    type="radio"
                                    id="avatarItem-{{ avatarItem.id }}"
                                    name="avatar"
                                    value="{{ avatarItem.id }}"
                                    aria-describedby="error-avatar"
                                    {% if user.avatar == avatarItem.id %}checked{% endif %}
                                    required
                                >
                                <label for="avatarItem-{{ avatarItem.id }}">
                                    <img src="{{ asset(avatarItem.urlMini) }}" alt="{{ avatarItem.description }}">
                                </label>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    <div class="error-message" id="error-avatar" role="alert" aria-live="polite"></div>
                </article>

                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <button type="submit" class="btn-primary">Mettre à jour mes informations</button>
            </form>

            {# ===================== TOGGLE NEWSLETTER ===================== #}
            <form method="post" action="?route=toggleNewsletter" class="newsletter-toggle">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                {% if user.newsletter == 1 %}
                    <button type="submit" class="btn-secondary">Se désabonner de la newsletter</button>
                {% else %}
                    <button type="submit" class="btn-secondary">S'abonner à la newsletter</button>
                {% endif %}
            </form>

            {# ===================== SECTION MESSAGES ===================== #}
            <section id="messages" class="messages-section">
                <h4>Mes messages</h4>
                <p>Envoyer un message à l'administrateur :</p>
                <button type="button" id="open-contact" class="btn-link">Ouvrir le formulaire de contact</button>
                <div id="contact-form-container"></div>
            </section>

            {# ===================== RESET PASSWORD ===================== #}
            <form method="post" action="?route=forgottenPassword" class="reset-password">
                <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                <input type="hidden" name="email" value="{{ user.email }}">
                <button type="submit" class="btn-warning">Réinitialiser mon mot de passe</button>
            </form>

            {# ===================== MESSAGES DE RETOUR ===================== #}
            {% if success_message %}
                <div class="alert alert-success">{{ success_message }}</div>
            {% endif %}
            {% if error_message %}
                <div class="alert alert-danger">{{ error_message }}</div>
            {% endif %}

        </section>
    {% endblock %}
{% endblock %}
